<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="baidu-site-verification" content="vuaTJrjFLn" />
    <meta name="keywords" content="foolchild,linux,java,技术,互联网" />
    <meta name="description" content="技术博客，记录foolchild技术道路上成长的点滴" />
    <title> 中断  </title>
    <link rel="stylesheet" href="/css/default.css" type="text/css"/>
    <link rel="stylesheet" href="/css/small.css" type="text/css" media="(max-width: 720px)"/>
    <link rel="stylesheet" href="/css/syntax.css" type="text/css"/>
    <link rel="stylesheet" href="/css/bootstrap.css" type="text/css"/>
    <link rel="stylesheet" href="/css/codeboy.css" type="text/css"/>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
</head>
<body>
<div id="container">
    <div class="nav">
    <div class="nav_nav">
        <a href="/">首页</a>
        <a href="/categories.html">分类</a>
        <a href="/booklist.html">书单</a>
        <a href="/about.html">关于</a>
    </div>
</div>

    <div id="main">
        <h2> 中断 </h2>
        <h4 id="section">处理机的状态</h4>

<h5 id="section-1">处理机的状态与分类</h5>

<ol>
  <li>
    <p>操作系统是计算机系统中最重要的系统软件，为了能正确地进行管理和控制，其本身是不能被破坏的。</p>
  </li>
  <li>
    <p>在系统中有两类程序在运行，一类是管理程序（如cpu调度程序、主存分配程序、I/O管理程序等）；另一类是用户程序。前者是管理和控制者，它负责管理和分配系统资源，为用户提供服务，而用户程序运行时，所需资源必须向操作系统提出请求，自己不能随意取用系统资源，这两类程序执行时应有不同的权限。</p>
  </li>
  <li>
    <p>为了保护操作系统，至少需要区分两种状态：管态和用户态</p>
  </li>
</ol>

<p>管态：又称系统态，是操作系统的管理程序执行时机器所处的状态，在此状态下允许cpu使用全部系统资源和全部指令。</p>

<p>用户态：又称目态，是用户程序执行时机器所处的状态。在此状态下禁止使用特权指令，不能直接取用系统资源与改变机器状态，并且只允许用户程序访问自己得到存储区域。</p>

<h5 id="section-2">特权指令</h5>
<p>在核态下，操作系统可以使用所有指令，包括一组特权指令，这些特权指令设计如下几个方面：</p>

<p>1.改变机器状态</p>

<p>2.修改特殊寄存器</p>

<p>3.涉及外部设备的输入输出</p>

<p>在下列情况下，由用户态自动转向管态：</p>

<p>1.用户进程访问操作系统要求操作系统的某种服务，这种访问称为系统功能调用</p>

<p>2.在用户进程执行时，发生一次终端</p>

<p>3.在一个用户进程中产生一个错误状态，这种状态被处理为内部中断</p>

<p>4.在用户态企图执行一条特权指令，作为一种特殊类型的错误，并按 3 处理</p>

<p>从管态返回用户态是用一条指令实现的，这条指令本身也是特权指令。</p>

<h4 id="section-3">中断</h4>

<h5 id="section-4">中断概念</h5>
<p>操作系统必须能提供多任务在CPU上快速转接的能力，自动地处理计算机系统中发生的各种事故的能力，需解决外设和cpu之间的通信问题。</p>

<p>中断是指某个事件（例如电源掉电，定点加法溢出或I/O传输结束等）发生时，系统中止现行程序的运行，引出处理该事件程序进行处理，处理完毕后返回断点，继续执行。</p>

<p>#####</p>

<p>中断类型
按中断功能</p>

<p>1.输入输出中断：当外部设备或者通道操作正常结束或发生某种错误时所发生的中断，例如I/O传输出错，I/O传输结束等</p>

<p>2.外中断：对某个CPU而言，它的外部非通道式装置所引起的中断称为外部中断，例如，时钟中断，操作员控制台中断、多机系统中CPU到CPU的通信中断等</p>

<p>3.机器故障中断：当机器发生故障时所产生的中断称为机器故障中断。例如，电源故障、通道与主存交换信息时主存出错、从主存取指令错、取数据错、长线传输时的奇偶校验错误等</p>

<p>4.程序性中断：如定点溢出、十进制溢出、十进制数错</p>

<p>5.访管中断：对操作系统提出某种需求（如请求I/O、建立进程等）所发生的中断称为访管中断。</p>

<p>按中断方式</p>

<p>强迫性中断：I/O中断，外中断、机器故障中断、程序性中断</p>

<p>自愿中断：访管中断</p>

<p>按中断来源</p>

<p>中断：由CPU外部事件引起的中断称为外中断，又称为中断，包括I/O中断，外中断</p>

<p>俘获：由CPU内部事件引起的中断成为俘获，包括访管中断、程序性中断、机器故障中断</p>

<h5 id="section-5">中断的过程</h5>

<p>保护现场</p>

<p>现场是指在中断的那一刻能确保程序继续运行的有关信息，主要包括：后继指令所在的主存的单元号、程序运行所处的状态（是用户态还是管态）、指令执行情况以及程序执行的中间结果等。对于多数机器而言，这些信息通常存放在指令计数器、通用寄存器（或累加器和某些机器的变址寄存器）以及一些特殊寄存器中。当中断发生时，必须立即把这些现场信息保存在主存中（不同程序的现场一般应保存在不同区域中），这就是保护现场。</p>

<p>恢复现场</p>

<p>为了确保被中断的程序从恢复点继续运行，必须在该程序重新运行之前，把保留的该程序现场信息从主存中送至相应的指令计数器、通用寄存器或一些特殊的寄存器中，完成这些工作称为恢复现场。</p>

<p>程序状态字</p>

<p>任何程序运行时都有反应其运行状态的一组信息，有的机器将这一组信息集中在一起称为程序状态字，存放这些信息的寄存器成为程序状态字寄存器。但是并不是所有机器都这样做。</p>

<p>程序状态字是反映程序执行时机器所处的现行状态的代码。它主要内容包括：</p>

<p>1.程序现在应该执行哪条指令</p>

<p>2.当前指令执行情况</p>

<p>3.cpu处于何种工作状态</p>

<p>4.程序在执行时应该屏蔽哪些中断</p>

<p>5.寻址方法、编址、保护键</p>

<p>6.响应中断的内容</p>

<p>上述信息存放在什么地方，不同机器可以采用不同的方法处置。</p>

<p>中断响应</p>

<p>中断响应是当cpu发现已有中断请求时，中止现行程序执行，并自动引出中断处理程序的过程。</p>

<p>中断响应的实质是交换指令执行地址和处理器状态,以达到如下目的：</p>

<p>1.保留程序断点及有关信息</p>

<p>2.自动转入相应的中断处理程序执行</p>

<p>中断响应所需的硬件支持包括：指令计数器、处理器状态寄存器、中断向量表和系统堆栈</p>

<p>整个中u单处理的功能是由硬件和软件配合完成的。硬件负责中断进入过程，即发现和响应中断请求，把中断的原因和断点记下来供软件处理时茶用，同时负责引出中断处理程序。而中断分析、中断处理、恢复被中断程序的现场等工作则由软件的中断处理程序来完成。</p>

<p>向量中断</p>

<p>当中断发生时，由中断源引导cpu进入中断服务程序的中断过程称为向量中断。为了提高中断的处理速度，在向量中断中，对于每一个中断类型都设置一个中断向量。中断向量就是存储该类型中断的中断服务例行程序的入口地址和cpu状态字的存储单元。系统中所有中断类型的中断向量放在一起，形成中断向量表。在中断向量表中，存放每一个中断向量的地址称为中断向量地址。在向量中断中，由于每一个中断都有自己的中断向量，所以发生某一个中断事件时，可直接进入处理该事件的中断处理程序。微型机一般采用向量中断机制。</p>

        <ul class="prev_next">
            
            <li>
                <span>上一篇</span>
                <a href="/2015/12/31/cpu">cpu调度</a>
            </li>
            
            
            <li>
                <span>下一篇</span>
                <a href="/2015/12/31/memory">内存管理</a>
            </li>
            
        </ul>
        <div class="ds-share flat" data-thread-key="/2015/12/31/interupt" data-title="中断"
             data-url="http://lcj1992.github.io/2015/12/31/interupt">
            <div class="ds-share-inline">
                <ul class="ds-share-icons-16">

                    <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
                    <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
                    <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

                </ul>
                <div class="ds-share-icons-more">
                </div>
            </div>
        </div>
        <div class="ds-thread" data-thread-key="/2015/12/31/interupt" data-title="中断"
             data-url="http://lcj1992.github.io/2015/12/31/interupt"></div>
        <!-- 多说评论框 end -->
        <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
        <script type="text/javascript">
            var duoshuoQuery = {short_name: "lcj1992"};
            (function () {
                var ds = document.createElement('script');
                ds.type = 'text/javascript';
                ds.async = true;
                ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                ds.charset = 'UTF-8';
                (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);
            })();
        </script>

        <!-- jQuery -->
        <script src="/js/jquery.js"></script>

        <!-- Bootstrap Core JavaScript -->
        <script src="/js/bootstrap.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/js/codeboy.js"></script>

        <script src="/js/bootstrap3-typeahead.js"></script>
        <script src="/js/jquery.hotkeys.js"></script>
        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r;
                i[r] = i[r] || function () {
                            (i[r].q = i[r].q || []).push(arguments)
                        }, i[r].l = 1 * new Date();
                a = s.createElement(o),
                        m = s.getElementsByTagName(o)[0];
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-72949519-1', 'auto');
            ga('send', 'pageview');

        </script>

        <!-- TODO: only load in tag.html -->
        <script src="/js/jquery.tagcloud.js" type="text/javascript" charset="utf-8"></script>
        <script language="javascript">
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'}
            };
            $(function () {
                $('#tag_cloud a').tagcloud();
            });
        </script>

        <!-- async load function -->
        <script>
            function async(u, c) {
                var d = document, t = 'script',
                        o = d.createElement(t),
                        s = d.getElementsByTagName(t)[0];
                o.src = u;
                if (c) {
                    o.addEventListener('load', function (e) {
                        c(null, e);
                    }, false);
                }
                s.parentNode.insertBefore(o, s);
            }
        </script>

        <!-- Highlight.js -->
        <script>
            async("https://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function () {
                hljs.initHighlightingOnLoad();
            })
        </script>
        <link href="https://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">


        <script>
            $(document).ready(function () {
                var time1 = 0;
                var show = false;
                var names = new Array(); //文章名字等
                var urls = new Array(); //文章地址
                $(document).keyup(function (e) {
                    var time2 = new Date().getTime();
                    if (e.keyCode == 17) {
                        var gap = time2 - time1;
                        time1 = time2;
                        if (gap < 500) {
                            if (show) {
                                $(".search-tool").css("display", "none");
                                show = false;
                            } else {
                                $(".search-tool").css("display", "block");
                                show = true;
                                $("#search-content").val("");
                                $("#search-content").focus();
                            }
                            time1 = 0;
                        }
                    } else if (e.keyCode == 27) {
                        $(".search-tool").css("display", "none");
                        show = false;
                        time1 = 0;
                    }
                });

                $("#search-content").keyup(function (e) {
                    var time2 = new Date().getTime();
                    if (window.event.keyCode == 17) {
                        var gap = time2 - time1;
                        time1 = time2;
                        if (gap < 500) {
                            if (show) {
                                $(".search-tool").css("display", "none");
                                show = false;
                            } else {
                                $(".search-tool").css("display", "block");
                                show = true;
                                $("#search-content").val("");
                                $("#search-content").focus();
                            }
                            time1 = 0;
                        }
                    }
                });

                $("#close-btn").click(function () {
                    $(".search-tool").css("display", "none");
                    show = false;
                    time1 = 0;
                });

                $("#search-btn").click(function () {
                    $(".search-tool").css("display", "block");
                    show = true;
                    $("#search-content").val("");
                    $("#search-content").focus();
                    time1 = 0;
                });
                // 家目录快捷键
                $(document).bind('keydown', 'alt+h', function () {
                    window.location.href = "/";
                });
                // 目录快捷键
                $(document).bind('keydown', 'alt+c', function () {
                    window.location.href = "/categories.html";
                });
                // 个人介绍页快捷键
                $(document).bind('keydown', 'alt+a', function () {
                    window.location.href = "/about.html";
                });
                // 上一篇
                $(document).bind('keydown', 'alt+p', function () {
                    window.location.href = "/2015/12/31/cpu";
                });
                // 下一篇
                $(document).bind('keydown', 'alt+n', function () {
                    window.location.href = "/2015/12/31/memory";
                });

                $.getJSON("/search.json").done(function (data) {
                    if (data.code == 0) {
                        for (var index in data.data) {
                            var item = data.data[index];
                            names.push(item.title);
                            urls.push(item.url);
                        }

                        $("#search-content").typeahead({
                            source: names,

                            afterSelect: function (item) {
                                $(".search-tool").css("display", "none");
                                show = false;
                                window.location.href = (urls[names.indexOf(item)]);
                                return item;
                            }
                        });
                    }
                });

            });
        </script>

        <style>
            @media screen and (min-width: 768px) {
                .dropdown-menu {
                    float: none;
                    font-size: 20px;
                    width: 70%;
                    margin: 0 15%;
                }

                .search-tool ul {
                    width: 70%;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }

                .search-content {
                    width: 70%;
                    margin: 0 15%;
                    position: absolute;
                    top: 13%;
                    left: auto;
                    right: auto;
                    font-size: 22px;
                    height: 50px;
                    background-color: #eee;
                    color: black;
                    opacity: 1.0;
                }
            }

            @media screen and (max-width: 767px) {
                .dropdown-menu {
                    float: none;
                    font-size: 20px;
                    width: 96%;
                    margin: 0 2%;
                }

                .search-tool ul {
                    width: 96%;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }

                .search-content {
                    width: 96%;
                    margin: 0 2%;
                    position: absolute;
                    top: 10%;
                    left: auto;
                    right: auto;
                    font-size: 22px;
                    height: 50px;
                    background-color: #eee;
                    color: black;
                    opacity: 1.0;
                }
            }
        </style>
        <div class="search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right:  0px;
      opacity: 0.95; background-color: #111111; z-index: 9999; display: none;">
            <input type="text" class="form-control search-content" id="search-content" placeholder="文章标题 日期 标签">

            <div style="position: fixed; top: 16px; right: 16px;">
                <img src="/images/search/close.png" id="close-btn"/>
            </div>
        </div>

        <div style="position: fixed; right: 12px; top: 50%;bottom: 50%;">
            <img src="/images/search/search.png" id="search-btn" title="双击ctrl试一下"/>
        </div>

    </div>
</div>
</body>
</html>

